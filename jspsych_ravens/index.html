<!DOCTYPE html><html class=''>
<head>
    <meta charset='UTF-8'>
    <meta name="robots" content="noindex">
    <title>The Experiment Factory ravens</title>

<link rel='stylesheet' type='text/css' href='jspsych.css'>
<link rel='stylesheet' type='text/css' href='default_style.css'>
<link rel='stylesheet' type='text/css' href='style.css'>
</head>

<body>
<script src='js/jquery.min.js'></script>
<script src='js/jspsych/jspsych.js'></script>
<script src="js/math.min.js"></script>
<script src='js/jspsych/plugins/jspsych-text.js'></script>
<script src='js/jspsych/poldrack_plugins/jspsych-poldrack-text.js'></script>
<script src='js/jspsych/poldrack_plugins/jspsych-poldrack-instructions.js'></script>
<script src='js/jspsych/poldrack_plugins/jspsych-poldrack-survey-multi-choice.js'></script>
<script src='js/jspsych/plugins/jspsych-call-function.js'></script>
<script src='js/jspsych/poldrack_plugins/jspsych-attention-check.js'></script>
<script src='js/jspsych/poldrack_plugins/jspsych-poldrack-single-stim.js'></script>
<script src='js/jspsych/plugins/jspsych-survey-text.js'></script>
<script src='js/jspsych/poldrack_plugins/jspsych-single-stim-button.js'></script>
<script src='js/jspsych/poldrack_plugins/poldrack_utils.js'></script>
<script src='experiment.js'></script>

<script>

function saveData(name, data){
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'write_data.php'); // 'write_data.php' is the path to the php file described above.
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.send(JSON.stringify({filename: name, filedata: data}));

  var next = moveOn();
  console.log("Moving to: " + next);

  document.open();
  document.write('<p style="text-align:center; font-family: Lucida, Console, monospace; font-size: large;">You can take a break now.<br /> <a href="'+next+'">Click here to continue</a>');
  document.close();

}

function setCookie(cname, cvalue, exdays) {
var d = new Date();
d.setTime(d.getTime() + (exdays*24*60*60*1000));
var expires = "expires="+ d.toUTCString();
document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
}

function getCookieValue(a) {
var b = document.cookie.match('(^|[^;]+)\\s*' + a + '\\s*=\\s*([^;]+)');
return b ? b.pop() : '';
}

function getID() {
var user_id = getCookieValue("id");
if (user_id != "") {
  return user_id;
} else {
  window.location.href = "https://www.psycholinguistics.ml/cookie_error.html?flanker=id";
}
}

function insertAfter(el, referenceNode) {
    referenceNode.parentNode.insertBefore(el, referenceNode);
}
function moveOn(){
var sequence = getCookieValue("group");
var progress = getCookieValue("progress");
var next = "https://www.psycholinguistics.ml/cookie_error.html?flanker=before";
var finalmessage = document.createElement("p");


if (progress != ""){
//update progress
progress = parseInt(progress)
progress++;
setCookie("progress", progress, 7);

//until all three elements done, continue to next test
if (progress<6){
  sequence = sequence[progress];
  switch (sequence){
      case "A":
      case "B":
      case "C":
      case "D":
      case "E":
      case "F":
      case "G":
      case "H":
        next ="https://www.psycholinguistics.ml/ibex/experiment.html";
        break;
      case "J":
        next ="https://www.psycholinguistics.ml/jspsych/experiment.html";
        break;
      case "K":
        next ="https://www.psycholinguistics.ml/jspsych_1/index.html";
        break;
      case "L":
        next ="https://www.psycholinguistics.ml/jspsych_2/reading_span_web_english.html";
        break;
      case "M":
        next ="https://www.psycholinguistics.ml/jspsych_3/index.html";
        break;
      case "N":
        next ="https://www.psycholinguistics.ml/jspsych_4/index.html";
        break;

      default:
          next  = "https://www.psycholinguistics.ml/cookie_error.html?flanker=after";
          }
}	else {
  next = "https://www.psycholinguistics.ml/finished.html";
}
}
return next;

}
  var user_id = getID();


$( document ).ready(function() {

    jsPsych.init({
             timeline: ravens_experiment,
             display_element: "getDisplayElement",
             fullscreen: true,
             on_trial_finish: function(data){
               addID('ravens')
             },

             on_finish: function() {
		saveData(user_id, jsPsych.data.dataAsCSV());
      }

      });
});
</script>
</body>
</html>
